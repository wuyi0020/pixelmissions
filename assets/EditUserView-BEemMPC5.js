import{_ as b,a as v,m as x,t as h,r as A,o as u,c as m,b as e,d as y,w as I,e as U,B as o,h as a,v as c}from"./index-C-_izT2N.js";import{U as _}from"./UserState-CIYhNpnI.js";import{a as d}from"./axios-Bo0ATomq.js";var T={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_API_PATH:g}=T,k=["Alldata","AdminToken","userHasLogIn","userID"],D=["AdminTokenCheck","getAlldata","setAdminToken"],E={data(){return{User:{},ThisUserID:"",oldimageUrl:""}},computed:{...v(_,k)},methods:{...x(_,D),async getArtdata(){await this.getAlldata(),this.User=this.Alldata[this.ThisUserID],this.oldimageUrl=this.Alldata[this.ThisUserID].imageUrl,this.userID!==this.ThisUserID&&this.$router.push(`/usercenter/${this.userID}`)},cancel(){this.$router.push(`/usercenter/${this.userID}`)},done(){this.setAdminToken();const l=`${f}/api/${g}/admin/product/${this.ThisUserID}`;d.defaults.headers.common.Authorization=this.AdminToken,d.put(l,{data:this.User}).then(s=>{this.$router.push(`/usercenter/${this.userID}`),h.success("修改成功")}).catch(()=>{h.warning("修改失敗")})},imagePreview(){const l=this.$refs.imgfileInput.files[0],s=new FileReader;s.readAsDataURL(l),s.onload=r=>{this.User.imageUrl=r.target.result}},upload(){if(this.User.imageUrl===this.oldimageUrl){this.done();return}const l=new FormData,s=this.$refs.imgfileInput.files[0];l.append("file-to-upload",s);const r=`${f}/api/${g}/admin/upload`;if(d.defaults.headers.common.Authorization=this.AdminToken,this.fileUrl===""){h.error("請選擇圖片");return}d.post(r,l).then(p=>{this.User.imageUrl=p.data.imageUrl,this.done()})},async UserDataCheck(){if(this.User.email===""||this.User.password===""){this.warningText="請輸入使用者名稱或密碼",this.warningswitch=!0;return}if(this.User.email.length<4||this.User.password.length<4){this.warningText="使用者名稱或密碼長度不足",this.warningswitch=!0;return}if(this.User.email.length>20||this.User.password.length>20){this.warningText="使用者名稱或密碼長度過長",this.warningswitch=!0;return}if(this.User.email.includes(" ")||this.User.password.includes(" ")||this.User.username.includes(" ")){this.warningText="使用者名稱或密碼不可包含空白",this.warningswitch=!0;return}await this.getAlldata(),Object.values(this.Alldata).filter(s=>s.email===this.User.email).length>1&&(this.warningText="使用者帳號已存在",this.warningswitch=!0)}},async mounted(){await this.getAlldata(),this.ThisUserID=this.$route.params.id,this.AdminTokenCheck(),this.getArtdata(),this.$refs.imgfileInput.addEventListener("change",this.imagePreview)}},V={class:"container pt-5"},C={class:"row justify-content-center"},R={class:"col-12 col-md-9 col-lg-6"},P={class:"card mt-3"},S={class:"card-body"},L={key:0,class:""},j=e("i",{class:"bi bi-caret-left-fill fs-4 text-white-50"},null,-1),N=e("p",{class:"card-title fs-4 mb-3"},"編輯使用者資料",-1),B={class:"d-flex justify-content-center align-items-center btn btn-outline-secondary rounded-3"},M={type:"file",ref:"imgfileInput",id:"fileInput"},O=["src"],z={class:"text-center"},H=["src"],F={class:"mt-3 d-flex justify-content-center"},W={class:"mt-3"},q=e("label",{class:""},"名稱：",-1),G={class:"mt-3"},J=e("label",{class:""},"自我描述：",-1),K={class:"mt-3"},Q=e("label",{class:""},"帳號/Email :",-1),X={class:"mt-3"},Y=e("label",{class:""},"密碼：",-1),Z={class:"mt-3 d-flex justify-content-between"},$=e("i",{class:"bi bi bi-x-circle-fill me-1"},null,-1),ee=e("span",null,"取消修改",-1),se=[$,ee],te=e("i",{class:"bi bi-check-circle-fill me-1"},null,-1),ie=e("span",null,"確定修改",-1),le=[te,ie];function re(l,s,r,p,t,n){const w=A("RouterLink");return u(),m("div",V,[e("div",C,[e("div",R,[e("div",P,[e("div",S,[t.User.id?(u(),m("div",L,[y(w,{to:{name:"UserCenter",params:{userid:t.User.id}},class:"text text-white link-underline link-underline-opacity-0 d-flex"},{default:I(()=>[j,N]),_:1},8,["to"])])):U("",!0),e("div",{class:o(["justify-content-center",{"d-none":t.User.imageUrl!=="","d-flex":t.User.imageUrl===""}])},[e("div",{class:o({"col-12 col-md-6 col-lg-3":t.User.imageUrl=="","col-12 col-md-9 col-lg-6":t.User.imageUrl!=""})},[e("div",{class:o(["d-flex justify-content-center mw-100 ratio ratio-1x1",{uploadStyle:t.User.imageUrl==""}])},[e("label",B,[e("input",M,null,512),e("p",{class:o(["m-0 p-0 fs-1",{"d-block":t.User.imageUrl=="","d-none":t.User.imageUrl!=""}])}," + ",2),e("img",{src:t.User.imageUrl,ref:"imagePreview2",class:"mw-100 ratio-1x1"},null,8,O)])],2)],2)],2),e("div",z,[t.User.imageUrl?(u(),m("img",{key:0,class:"card-img-top w-50 ratio-1x1",src:t.User.imageUrl},null,8,H)):U("",!0)]),e("div",F,[e("button",{type:"button",class:"w-100 btn btn-danger btn-lg",onClick:s[0]||(s[0]=i=>t.User.imageUrl="")}," 刪除圖片 ")]),e("div",W,[q,a(e("input",{type:"text",class:"form-control",placeholder:"使用者名稱","onUpdate:modelValue":s[1]||(s[1]=i=>t.User.title=i)},null,512),[[c,t.User.title]])]),e("div",G,[J,a(e("input",{type:"text",class:"form-control",placeholder:"描述","onUpdate:modelValue":s[2]||(s[2]=i=>t.User.description=i)},null,512),[[c,t.User.description]])]),e("div",K,[Q,a(e("input",{type:"text",class:"form-control",placeholder:"Email","onUpdate:modelValue":s[3]||(s[3]=i=>t.User.email=i)},null,512),[[c,t.User.email]])]),e("div",X,[Y,a(e("input",{type:"password",class:"form-control",placeholder:"Password","onUpdate:modelValue":s[4]||(s[4]=i=>t.User.password=i)},null,512),[[c,t.User.password]])]),e("div",Z,[e("button",{type:"button",class:"btn btn-outline-primary btn-lg",onClick:s[5]||(s[5]=(...i)=>n.cancel&&n.cancel(...i))},se),e("button",{type:"button",class:"btn btn-success btn-lg",onClick:s[6]||(s[6]=(...i)=>n.upload&&n.upload(...i))},le)])])])])])])}const ce=b(E,[["render",re]]);export{ce as default};
