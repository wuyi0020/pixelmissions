import{_ as A,a as b,m as U,z as h,o,c as r,b as t,e as a,x as d,A as m,B as _}from"./index-Bk2W6sNu.js";import{U as g}from"./UserState-D7ke27qt.js";import{a as u}from"./axios-Bo0ATomq.js";var I={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_API_PATH:y}=I,v=["Alldata","AdminToken","userHasLogIn","userID"],k=["AdminTokenCheck","getAlldata","setAdminToken"],D={data(){return{art:{},artAuthor:"",artID:"",oldimageUrl:""}},computed:{...b(g,v)},methods:{...U(g,k),async getArtdata(){await this.getAlldata(),this.art=this.Alldata[this.artID],this.artAuthor=this.Alldata[this.artID].author,this.oldimageUrl=this.Alldata[this.artID].imageUrl,this.artAuthor!==this.userID&&this.$router.push(`/usercenter/${this.userID}`)},cancel(){this.art.category==="作品"&&this.$router.push(`/dashboard/art/${this.userID}`),this.art.category==="報價"?this.$router.push(`/dashboard/comission/${this.userID}`):this.$router.push(`/usercenter/${this.userID}`)},done(){this.setAdminToken();const n=`${f}/api/${y}/admin/product/${this.artID}`;u.defaults.headers.common.Authorization=this.AdminToken,u.put(n,{data:this.art}).then(()=>{this.$router.push(`/usercenter/${this.userID}`),h.success("修改成功")}).catch(()=>{h.warning("修改失敗")})},imagePreview(){const n=this.$refs.imgfileInput.files[0],s=new FileReader;s.readAsDataURL(n),s.onload=l=>{this.art.imageUrl=l.target.result}},upload(){if(this.art.imageUrl===this.oldimageUrl){this.done();return}const n=new FormData,s=this.$refs.imgfileInput.files[0];n.append("file-to-upload",s);const l=`${f}/api/${y}/admin/upload`;if(u.defaults.headers.common.Authorization=this.AdminToken,this.fileUrl===""){h.error("請選擇圖片");return}u.post(l,n).then(p=>{this.art.imageUrl=p.data.imageUrl,this.done()})}},async mounted(){await this.getAlldata(),this.AdminTokenCheck(),this.getArtdata(),this.artID=this.$route.params.id,this.$refs.imgfileInput.addEventListener("change",this.imagePreview)}},x={class:"container pt-5"},w={class:"row justify-content-center"},T={class:"col-12 col-md-9 col-lg-6"},E={class:"card mt-3"},V={class:"card-body"},P={class:"card-title"},R={key:0},S={key:1},C={class:"d-flex justify-content-center align-items-center btn btn-outline-secondary rounded-3"},j={type:"file",ref:"imgfileInput",id:"fileInput"},L=["src"],B={class:"text-center"},M=["src"],N={class:"mt-3 d-flex justify-content-center"},z={class:"mt-3"},H={class:""},O={key:0},F={key:1},W={class:"mt-3"},q={class:""},G={key:0},J={key:1},K={key:0,class:"mt-3"},Q=t("label",{class:""},[t("span",null,"方案價格")],-1),X={class:"mt-3 d-flex justify-content-between"},Y=t("i",{class:"bi bi bi-x-circle-fill me-1"},null,-1),Z=t("span",null,"取消修改",-1),$=[Y,Z],tt=t("i",{class:"bi bi-check-circle-fill me-1"},null,-1),et=t("span",null,"確定修改",-1),st=[tt,et];function it(n,s,l,p,e,c){return o(),r("div",x,[t("div",w,[t("div",T,[t("div",E,[t("div",V,[t("h1",P,[e.art.category==="作品"?(o(),r("span",R,"編輯作品")):a("",!0),e.art.category==="報價"?(o(),r("span",S,"編輯方案")):a("",!0)]),t("div",{class:d(["justify-content-center",{"d-none":e.art.imageUrl!=="","d-flex":e.art.imageUrl===""}])},[t("div",{class:d({"col-12 col-md-6 col-lg-3":e.art.imageUrl=="","col-12 col-md-9 col-lg-6":e.art.imageUrl!=""})},[t("div",{class:d(["d-flex justify-content-center mw-50 ratio ratio-1x1",{uploadStyle:e.art.imageUrl==""}])},[t("label",C,[t("input",j,null,512),t("h1",{class:d(["m-0 p-0",{"d-block":e.art.imageUrl=="","d-none":e.art.imageUrl!=""}])}," + ",2),t("img",{src:e.art.imageUrl,ref:"imagePreview2",class:"mw-50 ratio-1x1"},null,8,L)])],2)],2)],2),t("div",B,[e.art.imageUrl?(o(),r("img",{key:0,class:"card-img-top w-50 ratio-1x1",src:e.art.imageUrl,alt:"作品圖片"},null,8,M)):a("",!0)]),t("div",N,[t("button",{type:"button",class:"w-100 btn btn-danger btn-lg",onClick:s[0]||(s[0]=i=>e.art.imageUrl="")}," 刪除圖片 ")]),t("div",z,[t("label",H,[e.art.category==="作品"?(o(),r("span",O,"作品名稱：")):a("",!0),e.art.category==="報價"?(o(),r("span",F,"方案名稱：")):a("",!0)]),m(t("input",{type:"text",class:"form-control",placeholder:"作品名稱","onUpdate:modelValue":s[1]||(s[1]=i=>e.art.title=i)},null,512),[[_,e.art.title]])]),t("div",W,[t("label",q,[e.art.category==="作品"?(o(),r("span",G,"作品描述")):a("",!0),e.art.category==="報價"?(o(),r("span",J,"方案描述")):a("",!0)]),m(t("input",{type:"text",class:"form-control",placeholder:"作品描述","onUpdate:modelValue":s[2]||(s[2]=i=>e.art.description=i)},null,512),[[_,e.art.description]])]),e.art.category==="報價"?(o(),r("div",K,[Q,m(t("input",{type:"text",class:"form-control",placeholder:"方案價格","onUpdate:modelValue":s[3]||(s[3]=i=>e.art.price=i)},null,512),[[_,e.art.price]])])):a("",!0),t("div",X,[t("button",{type:"button",class:"btn btn-danger btn-lg",onClick:s[4]||(s[4]=(...i)=>c.cancel&&c.cancel(...i))},$),t("button",{type:"button",class:"btn btn-success btn-lg",onClick:s[5]||(s[5]=(...i)=>c.upload&&c.upload(...i))},st)])])])])])])}const nt=A(D,[["render",it]]);export{nt as default};
