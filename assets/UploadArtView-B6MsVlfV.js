import{a as r}from"./axios-Bo0ATomq.js";import{U as f}from"./UserState-CxXzrXXr.js";import{_ as V,m as w,j as _,a as b,r as c,o as I,c as y,b as e,n as i,d as l,w as E,l as T}from"./index-CALbCaTn.js";import{V as h,d as x,l as A,c as k,F as S,a as R,E as P,z as M}from"./zh_TW-Dci9-G_w.js";var j={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_API_PATH:v}=j,z=["AdminToken","userID"],F=["setAdminToken","checkUserLogin"];Object.keys(h).forEach(o=>{x(o,h[o])});A({zh_TW:M});k({generateMessage:A("zh_TW"),validateOnInput:!0});const L={components:{VField:S,VForm:R,ErrorMessage:P},data(){return{fileUrl:"",form:{user:{email:""}},ArtData:{author:"",category:"作品",content:"",description:"",imageUrl:"",is_enabled:1,like:0,origin_price:0,price:0,time:0,title:"",unit:"元"}}},mounted(){this.$refs.imgfileInput.addEventListener("change",this.imagePreview),this.setAdminToken(),this.checkUserLogin()},methods:{...w(f,F),imagePreview(){const o=this.$refs.imgfileInput.files[0],s=new FileReader;s.readAsDataURL(o),s.onload=n=>{this.fileUrl=n.target.result}},upload(){console.log("upload");const o=new FormData,s=this.$refs.imgfileInput.files[0];o.append("file-to-upload",s);const n=`${g}/api/${v}/admin/upload`,d=`${g}/api/${v}/admin/product`;if(r.defaults.headers.common.Authorization=this.AdminToken,this.ArtData.author=this.userID,this.ArtData.time=new Date().getTime(),console.log(this.ArtData),this.fileUrl===""){_.error("請選擇圖片");return}r.post(n,o).then(t=>(this.fileUrl=t.data.imageUrl,this.ArtData.imageUrl=t.data.imageUrl,console.log(this.ArtData),r.post(d,{data:this.ArtData}))).then(t=>{console.log(t),this.$router.push(`/usercenter/${this.userID}`),_.success("上傳成功")}).catch(t=>{console.log(t)})}},computed:{...b(f,z)}},N={class:"container mt-5"},O={class:"row"},B=e("div",{class:"col-12"},[e("h1",null,"上傳作品")],-1),W={class:"justify-content-center d-flex"},C={class:"d-flex justify-content-center align-items-center btn btn-outline-secondary rounded-3"},q={type:"file",ref:"imgfileInput",id:"fileInput"},H=["src"],$=e("hr",null,null,-1),G={class:"row justify-content-center"},J={class:"input-group mb-3"},K=e("span",{class:"input-group-text"},"作品名稱",-1),Q={class:"input-group mb-3"},X=e("span",{class:"input-group-text",id:"basic-addon1"},"作品描述",-1),Y=e("div",{class:"row justify-content-center"},null,-1),Z=e("div",{id:"imagePreview"},null,-1);function ee(o,s,n,d,t,U){const u=c("v-field"),m=c("error-message"),D=c("v-form");return I(),y("div",N,[e("div",O,[B,e("div",W,[e("div",{class:i({"col-12 col-md-6 col-lg-3":t.fileUrl=="","col-12 col-md-9 col-lg-6":t.fileUrl!=""})},[e("div",{class:i(["d-flex justify-content-center mw-100 ratio ratio-1x1",{uploadStyle:t.fileUrl==""}])},[e("label",C,[e("input",q,null,512),e("h1",{class:i(["m-0 p-0",{"d-block":t.fileUrl=="","d-none":t.fileUrl!=""}])}," + ",2),e("img",{src:t.fileUrl,ref:"imagePreview2",class:"mw-100 ratio-1x1"},null,8,H)])],2)],2)])]),$,e("div",G,[l(D,{class:"col-12 col-md-9 col-lg-6 text-center",ref:"form",onSubmit:U.upload},{default:E(({errors:p})=>[e("div",J,[K,l(u,{id:"title",name:"作品名稱",type:"",class:i(["form-control",{"is-invalid":p.作品名稱}]),placeholder:"作品名稱",rules:"required",modelValue:t.ArtData.title,"onUpdate:modelValue":s[0]||(s[0]=a=>t.ArtData.title=a)},null,8,["class","modelValue"]),l(m,{name:"作品名稱",class:"invalid-feedback"})]),e("div",Q,[X,l(u,{id:"description",name:"作品描述",type:"",class:i([{"is-invalid":p.作品描述},"form-control"]),placeholder:"作品描述",rules:"required",modelValue:t.ArtData.description,"onUpdate:modelValue":s[1]||(s[1]=a=>t.ArtData.description=a)},null,8,["class","modelValue"]),l(m,{name:"作品描述",class:"invalid-feedback"})]),e("button",{class:"btn btn-primary w-100 rounded-pill",type:"submit",onSubmit:s[2]||(s[2]=T(()=>{},["prevent"]))}," 上傳 ",32)]),_:1},8,["onSubmit"])]),Y,Z])}const le=V(L,[["render",ee]]);export{le as default};
