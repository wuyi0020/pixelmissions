import{a as c}from"./axios-Bo0ATomq.js";import{h as D}from"./moment-Cl4UOzQZ.js";import{_ as I,a as T,m as S,j as b,r as x,o as h,c as d,b as t,t as i,d as k,n as w,l as u,e as A,w as g,F as N,h as L,g as y}from"./index-CnB8nTM4.js";import{U}from"./UserState-BoEKTuGp.js";var E={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/undefined/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p,VITE_API_PATH:v}=E,V=["userName","userEmail","userID","userHasLogIn","AdminToken","Alldata"],C=["setAdminToken","PushUrl","getAlldata"];let r=null,_=null;const j={data(){return{art:{},ArtID:{},author:{},User:{},NotFund:!1,time:"",haslike:!1,AuthorWorks:[],hasfollow:!1}},async mounted(){await this.setAdminToken(),this.Artinit()},computed:{...T(U,V),formattedTime(){if(this.art.time===void 0)return"";const o=new Date(this.art.time);return D(o).format("YYYY-MM-DD")}},methods:{...S(U,C),async Artinit(){if(await this.setAdminToken(),await this.getAlldata(),this.ArtID=this.$route.params.id,this.art=Object.values(this.Alldata).find(o=>o.id===this.ArtID),this.art===void 0){this.NotFund=!0;return}this.author=Object.values(this.Alldata).find(o=>o.id===this.art.author),this.User=Object.values(this.Alldata).find(o=>o.id===this.userID),this.AuthorWorks=Object.values(this.Alldata).filter(o=>o.author===this.author.id&&o.category==="作品"),r=new Set(this.User.likeList),_=new Set(this.User.followList),this.hasfollow=_.has(this.author.id),this.haslike=r.has(this.art.id)},likeArt(o){const e=this.art,n=this.User;isNaN(e.like)&&(e.like=0),o?(e.like=e.like-1,r.delete(this.art.id),n.likeList=[...r],this.haslike=r.has(this.art.id)):(e.like=e.like+1,r=new Set(n.likeList),r.add(this.art.id),n.likeList=[...r],this.haslike=r.has(this.art.id)),console.log("this.haslike",this.haslike),c.defaults.headers.common.Authorization=this.AdminToken;const m=`${p}/api/${v}/admin/product/${this.art.id}`,s=`${p}/api/${v}/admin/product/${this.userID}`;c.put(m,{data:e}).then(()=>c.put(s,{data:n})).then(()=>{this.art=e,this.User=n}).catch(a=>{console.log(a)})},ShareArt(){navigator.clipboard.writeText(window.location.href).then(()=>{b.success("網址已複製到剪貼簿")}).catch(()=>{b.warning("複製失敗")}).finally(()=>{console.log("finally")})},followAuthor(){const o=this.author,e=this.User;isNaN(this.author.fans)&&(this.author.fans=1),this.hasfollow?(this.hasfollow=!1,_.delete(this.author.id),e.followList=[..._],o.fans=o.fans-1):(this.hasfollow=!0,_.add(this.author.id),e.followList=[..._],o.fans=o.fans+1),c.defaults.headers.common.Authorization=this.AdminToken;const n=`${p}/api/${v}/admin/product/${this.author.id}`,m=`${p}/api/${v}/admin/product/${this.userID}`;c.put(n,{data:o}).then(()=>(this.author=o,c.put(m,{data:e}))).then(()=>{this.User=e}).catch(s=>{console.log(s)})}}},P={key:0,class:"container h-100 pt-5"},M={class:"row"},O={class:"col-12 rounded-top-4 col-md-9 bg-dark-subtle rounded-top-2 text-center"},R=["src"],F={class:"col-3 d-none d-sm-none d-md-block"},W={class:"d-flex position-relative align-items-center"},B=["src"],Y={class:"px-2 m-0 text-center user-select-none"},z={key:0,class:"pt-2"},H={class:"pt-2"},q={class:"row"},G={class:"col-12 col-md-9 bg-dark-subtle"},J={class:"d-flex mt-3 align-items-center justify-content-end"},K={class:"me-auto"},Q=t("i",{class:"bi bi-arrow-90deg-right"},"分享",-1),X=[Q],Z={class:"row"},$={class:"col-12 col-md-9 bg-dark-subtle"},tt={class:"mt-2"},st={class:""},et={class:"row"},ot={class:"col-12 col-md-9 py-3 bg-dark-subtle"},it={class:"d-flex align-items-center"},lt={class:"d-flex position-relative align-items-center"},rt=["src"],nt={class:"px-2 m-0 text-center user-select-none"},at={key:0,class:"m-0 text-center"},ct={class:"row"},ht=t("div",{class:"col-12 col-md-9 pt-3 bg-dark-subtle"},[t("h3",null,"相關作品")],-1),dt={class:"col-12 col-md-9 rounded-bottom-4 bg-dark-subtle overflow-auto scrollbar1"},ut={class:"d-flex"},_t=["src"],mt={key:1,class:"container h-100"},ft={class:"row justify-content-center"},kt={class:"col-12 col-md-9 bg-dark-subtle flex-grow-1"},pt=t("h1",{class:"user-select-none"},"找不到作品",-1);function vt(o,e,n,m,s,a){const f=x("router-link");return s.NotFund?(h(),d("div",mt,[t("div",ft,[t("div",kt,[pt,k(f,{role:"button",to:"/",class:"btn btn-primary"},{default:g(()=>[y("回首頁")]),_:1})])])])):(h(),d("div",P,[t("div",M,[t("div",O,[t("img",{width:"500",class:"mw-100",src:s.art.imageUrl,alt:""},null,8,R)]),t("div",F,[t("div",W,[t("img",{width:"50",src:s.author.imageUrl,class:"rounded-circle"},null,8,B),t("p",Y,i(s.author.title),1),k(f,{to:`/usercenter/${s.author.id}`,class:"stretched-link"},null,8,["to"])]),s.author.id!=o.userID?(h(),d("div",z,[t("button",{class:w(["btn w-100 rounded-pill",{"btn-primary":!s.hasfollow,"btn-secondary":s.hasfollow}]),onClick:e[0]||(e[0]=u(l=>a.followAuthor(),["prevent"]))},i(s.hasfollow?"已關注":"加入關注"),3)])):A("",!0),t("div",H,[k(f,{to:`/usercomission/${o.userID}`,class:"btn btn-outline-secondary w-100 rounded-pill"},{default:g(()=>[y("查看約稿方案")]),_:1},8,["to"])])])]),t("div",q,[t("div",G,[t("div",J,[t("div",K,[t("h2",null,i(s.art.title),1)]),t("button",{class:"btn btn-outline-secondary",onClick:e[1]||(e[1]=u(l=>a.likeArt(s.haslike),["prevent"]))},[t("i",{class:w(["bi",{"bi-heart-fill":s.haslike,"bi-heart":!s.haslike}])},i(s.haslike?" 已收藏":" 收藏")+" "+i(s.art.like),3)]),t("button",{class:"btn ms-3 btn-outline-secondary",onClick:e[2]||(e[2]=u(l=>a.ShareArt(),["prevent"]))},X)])])]),t("div",Z,[t("div",$,[t("p",tt,i(s.art.description),1),t("p",st,i(s.time),1)])]),t("div",et,[t("div",ot,[t("div",it,[t("div",lt,[t("img",{width:"50",src:s.author.imageUrl,class:"rounded-circle"},null,8,rt),t("p",nt,i(s.author.title)+" "+i(s.author.fans),1),t("a",{href:"",onClick:e[3]||(e[3]=u(l=>o.PushUrl("/usercenter/"+s.author.id),["prevent"])),class:"stretched-link"})]),s.author.id!=o.userID?(h(),d("p",at,[t("button",{class:w(["btn rounded-pill",{"btn-primary":!s.hasfollow,"btn-secondary":s.hasfollow}]),onClick:e[4]||(e[4]=u(l=>a.followAuthor(),["prevent"]))},i(s.hasfollow?"已關注":"加入關注"),3)])):A("",!0),t("a",{href:"",onClick:e[5]||(e[5]=u(l=>o.PushUrl("/usercenter/"+s.author.id),["prevent"])),class:"link-secondary ms-auto link-underline link-opacity-50 link-underline-opacity-25 link-opacity-100-hover"},"查看作品")])])]),t("div",ct,[ht,t("div",dt,[t("div",ut,[(h(!0),d(N,null,L(s.AuthorWorks,l=>(h(),d("div",{class:"p-1 position-relative",key:"AuthorWorks"+l.id},[t("img",{src:l.imageUrl,height:"150",width:"150",class:"mh-100 object-position-50 object-fit-cover",alt:""},null,8,_t),k(f,{to:`/art/${l.id}`,class:"stretched-link"},null,8,["to"])]))),128))])])])]))}const yt=I(j,[["render",vt]]);export{yt as default};
