import{a}from"./axios-Bo0ATomq.js";import{h as x}from"./moment-Cl4UOzQZ.js";import{_ as I,a as D,m as T,t as v,r as S,o as h,c,b as t,i as o,d as p,B as b,C as d,e as g,w as y,g as A,F as L,z as N}from"./index-z1AvBJhR.js";import{U}from"./UserState-DLMa-bTK.js";var E={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:k,VITE_API_PATH:w}=E,V=["userName","userEmail","userID","userHasLogIn","AdminToken","Alldata"],C=["setAdminToken","PushUrl","getAlldata"];let l=null,u=null;const P={data(){return{art:{},ArtID:{},author:{},User:{},NotFund:!1,time:"",haslike:!1,AuthorWorks:[],hasfollow:!1}},async mounted(){await this.setAdminToken(),this.Artinit(),this.logincheck()},computed:{...D(U,V),formattedTime(){if(this.art.time===void 0)return"";const i=new Date(this.art.time);return x(i).format("YYYY-MM-DD")}},methods:{...T(U,C),logincheck(){this.userHasLogIn||(this.PushUrl("/login"),v.warning("請先登入"))},async Artinit(){if(await this.setAdminToken(),await this.getAlldata(),this.ArtID=this.$route.params.id,this.art=Object.values(this.Alldata).find(i=>i.id===this.ArtID),this.art===void 0){this.NotFund=!0;return}this.author=Object.values(this.Alldata).find(i=>i.id===this.art.author),this.User=Object.values(this.Alldata).find(i=>i.id===this.userID),this.AuthorWorks=Object.values(this.Alldata).filter(i=>i.author===this.author.id&&i.category==="作品"),l=new Set(this.User.likeList),u=new Set(this.User.followList),this.hasfollow=u.has(this.author.id),this.haslike=l.has(this.art.id)},likeArt(i){const e=this.art,n=this.User;isNaN(e.like)&&(e.like=0),i?(e.like=e.like-1,l.delete(this.art.id),n.likeList=[...l],this.haslike=l.has(this.art.id)):(e.like=e.like+1,l=new Set(n.likeList),l.add(this.art.id),n.likeList=[...l],this.haslike=l.has(this.art.id)),a.defaults.headers.common.Authorization=this.AdminToken;const m=`${k}/api/${w}/admin/product/${this.art.id}`,s=`${k}/api/${w}/admin/product/${this.userID}`;a.put(m,{data:e}).then(()=>a.put(s,{data:n})).then(()=>{this.art=e,this.User=n})},ShareArt(){navigator.clipboard.writeText(window.location.href).then(()=>{v.success("網址已複製到剪貼簿")}).catch(()=>{v.warning("複製失敗")})},followAuthor(){const i=this.author,e=this.User;isNaN(this.author.fans)&&(this.author.fans=1),this.hasfollow?(this.hasfollow=!1,u.delete(this.author.id),e.followList=[...u],i.fans=i.fans-1):(this.hasfollow=!0,u.add(this.author.id),e.followList=[...u],i.fans=i.fans+1),a.defaults.headers.common.Authorization=this.AdminToken;const n=`${k}/api/${w}/admin/product/${this.author.id}`,m=`${k}/api/${w}/admin/product/${this.userID}`;a.put(n,{data:i}).then(()=>(this.author=i,a.put(m,{data:e}))).then(()=>{this.User=e})}}},j={key:0,class:"container h-100 pt-5"},M={class:"row"},O={class:"col-12 rounded-top-4 col-md-9 bg-dark-subtle rounded-top-2 text-center"},R=["src","alt"],B={class:"col-3 d-none d-sm-none d-md-block"},F={class:"d-flex position-relative align-items-center"},H=["src"],W={class:"px-2 m-0 text-center user-select-none fs-5"},z={key:0,class:"pt-2"},Y={class:"pt-2"},q={class:"row"},G={class:"col-12 col-md-9 bg-dark-subtle"},J={class:"d-flex mt-3 align-items-center justify-content-end"},K={class:"me-auto"},Q=t("i",{class:"bi bi-arrow-90deg-right text-white"},"分享",-1),X=[Q],Z={class:"row"},$={class:"col-12 col-md-9 bg-dark-subtle"},tt={class:"mt-2"},st={class:""},et={class:"row"},it={class:"col-12 col-md-9 py-3 bg-dark-subtle"},ot={class:"d-flex align-items-center"},rt={class:"d-flex position-relative align-items-center"},lt=["src"],nt={class:"px-2 m-0 text-center fs-5 user-select-none"},at={class:"text fs-6"},ht={key:0,class:"m-0 text-center"},ct={class:"row"},dt=t("div",{class:"col-12 col-md-9 pt-3 bg-dark-subtle"},[t("h3",null,"相關作品")],-1),ut={class:"col-12 col-md-9 rounded-bottom-4 bg-dark-subtle overflow-auto scrollbar1"},mt={class:"d-flex"},_t=["src"],ft={key:1,class:"container h-100"},pt={class:"row justify-content-center"},kt={class:"col-12 col-md-9 bg-dark-subtle flex-grow-1"},wt=t("h3",{class:"user-select-none"},"找不到作品",-1);function vt(i,e,n,m,s,_){const f=S("router-link");return s.NotFund?(h(),c("div",ft,[t("div",pt,[t("div",kt,[wt,p(f,{role:"button",to:"/",class:"btn btn-primary"},{default:y(()=>[A("回首頁")]),_:1})])])])):(h(),c("div",j,[t("div",M,[t("div",O,[t("img",{class:"mw-100 artMaxHight",src:s.art.imageUrl,alt:s.art.id},null,8,R)]),t("div",B,[t("div",F,[t("img",{width:"50",src:s.author.imageUrl,class:"rounded-circle",alt:"作者"},null,8,H),t("p",W,o(s.author.title),1),p(f,{to:`/usercenter/${s.author.id}`,class:"stretched-link"},null,8,["to"])]),s.author.id!=i.userID?(h(),c("div",z,[t("button",{type:"button",class:b(["btn w-100 rounded-pill",{"btn-primary":!s.hasfollow,"btn-secondary":s.hasfollow}]),onClick:e[0]||(e[0]=d(r=>_.followAuthor(),["prevent"]))},o(s.hasfollow?"已關注":"加入關注"),3)])):g("",!0),t("div",Y,[p(f,{to:`/usercomission/${s.author.id}`,class:"btn btn-outline-primary w-100 rounded-pill text-white"},{default:y(()=>[A("查看約稿方案")]),_:1},8,["to"])])])]),t("div",q,[t("div",G,[t("div",J,[t("div",K,[t("h2",null,o(s.art.title),1)]),t("button",{type:"button",class:"btn btn-outline-primary",onClick:e[1]||(e[1]=d(r=>_.likeArt(s.haslike),["prevent"]))},[t("i",{class:b(["bi text-white",{"bi-heart-fill":s.haslike,"bi-heart":!s.haslike}])},o(s.haslike?" 已收藏":" 收藏")+" "+o(s.art.like),3)]),t("button",{type:"button",class:"btn ms-3 btn-outline-primary",onClick:e[2]||(e[2]=d(r=>_.ShareArt(),["prevent"]))},X)])])]),t("div",Z,[t("div",$,[t("p",tt,o(s.art.description),1),t("p",st,o(s.time),1)])]),t("div",et,[t("div",it,[t("div",ot,[t("div",rt,[t("img",{width:"50",src:s.author.imageUrl,class:"rounded-circle",alt:"作者"},null,8,lt),t("p",nt,[A(o(s.author.title)+" ",1),t("span",at,"關注者"+o(s.author.fans),1)]),t("a",{href:"",onClick:e[3]||(e[3]=d(r=>i.PushUrl("/usercenter/"+s.author.id),["prevent"])),class:"stretched-link"})]),s.author.id!=i.userID?(h(),c("p",ht,[t("button",{type:"button",class:b(["btn rounded-pill",{"btn-primary":!s.hasfollow,"btn-secondary":s.hasfollow}]),onClick:e[4]||(e[4]=d(r=>_.followAuthor(),["prevent"]))},o(s.hasfollow?"已關注":"加入關注"),3)])):g("",!0),t("a",{href:"",onClick:e[5]||(e[5]=d(r=>i.PushUrl("/usercenter/"+s.author.id),["prevent"])),class:"link-secondary ms-auto text-white link-underline link-underline-opacity-25 link-opacity-100-hover"},"查看作品")])])]),t("div",ct,[dt,t("div",ut,[t("div",mt,[(h(!0),c(L,null,N(s.AuthorWorks,r=>(h(),c("div",{class:"p-1 position-relative artbox my-2",key:"AuthorWorks"+r.id},[t("img",{src:r.imageUrl,height:"150",width:"150",class:"mh-100 object-position-50 object-fit-cover",alt:"作品圖片"},null,8,_t),p(f,{to:`/art/${r.id}`,class:"stretched-link"},null,8,["to"])]))),128))])])])]))}const Ut=I(P,[["render",vt]]);export{Ut as default};
