import{_ as x,L as A,m as D,t as v,a as w,r as T,o as n,c as l,d as I,b as s,F as m,z as b,i as a,e as h,g as E,B as L}from"./index-z1AvBJhR.js";import{U as y}from"./UserState-DLMa-bTK.js";import{a as r}from"./axios-Bo0ATomq.js";import{h as V}from"./moment-Cl4UOzQZ.js";var P={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const N=["userName","userEmail","userID","userHasLogIn","AdminToken","Alldata"],S=["checkUserLogin","getAlldata","PushUrl"],{VITE_URL:g,VITE_API_PATH:f}=P,$={data(){return{Orders:[],ThisUserOrders:[],pagination:{},Users:{},isLoading:!0}},components:{Loading:A},methods:{...D(y,S),Pay(e){const o=`${g}/api/${f}/pay/${e}`;r.post(o).then(c=>{v.success("付款成功")}).then(()=>{this.Orders=[],this.getOeder()})},deleteOrder(e){const o=`${g}/api/${f}/admin/order/${e}`;r.defaults.headers.common.Authorization=this.AdminToken,r.delete(o).then(c=>{v.success("刪除成功")}).then(()=>{this.Orders=[],this.getOeder()})},async getOeder(){r.defaults.headers.common.Authorization=this.AdminToken;let e=!0,o=1;for(;e;){const c=`${g}/api/${f}/orders?page=${o}`;await r.get(c).then(_=>{this.Orders=[...this.Orders,..._.data.orders],this.pagination=_.data.pagination,e=_.data.pagination.has_next,o++}).catch(()=>{e=!1})}this.ThisUserOrders=this.Orders.filter(c=>c.user.userid===this.userID)},getUsers(){Object.values(this.Alldata).forEach(e=>{e.category==="使用者"&&(this.Users[e.id]=e)})},loadDone(){this.isLoading=!1}},async mounted(){await this.getAlldata(),this.getOeder(),this.checkUserLogin(),this.getUsers()},computed:{...w(y,N),formattedTime(e){if(e===void 0)return"";const o=new Date(e);return V(o).format("YYYY-MM-DD")}}},C={class:"container"},R=s("div",{class:"row"},[s("h3",{class:"mt-5"},"委託訂單確認")],-1),M={class:"container"},B={class:"col-12 p-5 bg bg-dark-subtle rounded-5"},z={class:"col-md-4"},Y=["src"],H={class:"col-md-8 d-flex flex-column"},F={class:"card-body"},W={key:0,class:"d-flex align-items-center"},j=["src"],q={class:"mx-2 h3"},G={class:"card-title h3 my-2"},J={class:"mb-0 my-2"},K={class:""},Q={class:""},X={class:""},Z={key:0,class:"ms-2 text-success-emphasis"},ss={class:"row gx-3"},ts={class:"col-9"},es=["onClick"],os={class:"col-3"},as=["onClick"],is=s("i",{class:"bi bi-trash3"},null,-1),ns=[is],ls={class:"col-12"},cs=["data-bs-target","aria-controls"],ds=s("i",{class:"bi bi-arrow-down-circle"},null,-1),rs=s("hr",null,null,-1),_s=["id"],us=s("h3",null,"Email :",-1),hs=s("hr",null,null,-1),ps=s("h3",null,"姓名 :",-1),ms=s("hr",null,null,-1),gs=s("h3",null,"收件人地址 :",-1),fs=s("hr",null,null,-1),vs=s("h3",null,"電話 :",-1),bs=s("hr",null,null,-1),ys=s("h3",null,"付款狀態 :",-1),Us=s("hr",null,null,-1),Os=s("h3",null,"留言訊息 :",-1);function ks(e,o,c,_,d,u){const U=T("loading");return n(),l(m,null,[I(U,{active:d.isLoading,"onUpdate:active":o[0]||(o[0]=t=>d.isLoading=t),"can-cancel":!0,"on-cancel":e.onCancel,"is-full-page":e.fullPage},null,8,["active","on-cancel","is-full-page"]),s("div",C,[R,s("div",M,[(n(!0),l(m,null,b(d.ThisUserOrders,(t,O)=>(n(),l("div",{class:"row mb-5",key:O},[s("div",B,[(n(!0),l(m,null,b(t.products,(i,k)=>(n(),l("div",{class:"row g-5",key:i.product.id+"order"+k},[s("div",z,[s("img",{src:i.product.imageUrl,class:"img-fluid rounded-start-0 ratio-1x1 mh-100",alt:"方案",onLoad:o[1]||(o[1]=(...p)=>u.loadDone&&u.loadDone(...p))},null,40,Y)]),s("div",H,[s("div",F,[i.product.author?(n(),l("div",W,[s("img",{src:d.Users[i.product.author].imageUrl,width:"60px",class:"img-fluid ratio-1x1 rounded-circle",alt:"作者"},null,8,j),s("span",q,a(d.Users[i.product.author].title),1)])):h("",!0),s("p",G,a(i.product.title),1),s("p",J,a(i.product.description),1),s("p",K,a(i.product.content),1)]),s("div",Q,[s("span",X,a(i.total)+" TWD",1),t.is_paid?(n(),l("span",Z,"(付款完成)")):h("",!0)]),s("div",ss,[s("div",ts,[t.is_paid?h("",!0):(n(),l("button",{key:0,type:"button",class:"btn w-100 btn-primary btn-lg rounded-pill",onClick:p=>u.Pay(t.id)}," 前往付款 ",8,es))]),s("div",os,[t.is_paid?h("",!0):(n(),l("button",{key:0,type:"button",class:"btn w-100 btn-outline-danger btn-lg rounded-pill",onClick:p=>u.deleteOrder(t.id)},ns,8,as))])])]),s("div",ls,[s("h3",{type:"button","data-bs-toggle":"collapse","data-bs-target":`#collapseID${t.id}`,"aria-expanded":"false","aria-controls":`collapseID${t.id}`},[E(" 訂單資料 "),ds],8,cs),rs,s("div",{id:`collapseID${t.id}`,class:"collapse"},[us,s("p",null,a(t.user.email),1),hs,ps,s("p",null,a(t.user.name),1),ms,gs,s("p",null,a(t.user.address),1),fs,vs,s("p",null,a(t.user.tel),1),bs,ys,s("p",{class:L({"text-danger":!t.is_paid,"text-success":t.is_paid})},a(t.is_paid?"完成付款":"尚未付款"),3),Us,Os,s("p",null,a(t.message?t.message:"沒有留言"),1)],8,_s)])]))),128))])]))),128))])])],64)}const Ts=x($,[["render",ks]]);export{Ts as default};
