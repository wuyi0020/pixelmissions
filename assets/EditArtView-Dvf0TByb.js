import{_ as x,a as I,m as v,t as h,r as w,o as i,c as l,b as t,f as g,w as y,e as r,B as d,h as m,v as _,g as b}from"./index-BKyi1mnf.js";import{U as A}from"./UserState-DTLkBWnh.js";import{a as u}from"./axios-Bo0ATomq.js";var D={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:k,VITE_API_PATH:U}=D,T=["Alldata","AdminToken","userHasLogIn","userID"],E=["AdminTokenCheck","getAlldata","setAdminToken"],V={data(){return{art:{},artAuthor:"",artID:"",oldimageUrl:""}},computed:{...I(A,T)},methods:{...v(A,E),async getArtdata(){await this.getAlldata(),this.art=this.Alldata[this.artID],this.artAuthor=this.Alldata[this.artID].author,this.oldimageUrl=this.Alldata[this.artID].imageUrl,this.artAuthor!==this.userID&&this.$router.push(`/usercenter/${this.userID}`)},cancel(){this.art.category==="作品"&&this.$router.push(`/dashboard/art/${this.userID}`),this.art.category==="報價"?this.$router.push(`/dashboard/comission/${this.userID}`):this.$router.push(`/usercenter/${this.userID}`)},done(){this.setAdminToken();const n=`${k}/api/${U}/admin/product/${this.artID}`;u.defaults.headers.common.Authorization=this.AdminToken,u.put(n,{data:this.art}).then(()=>{this.$router.push(`/usercenter/${this.userID}`),h.success("修改成功")}).catch(()=>{h.warning("修改失敗")})},imagePreview(){const n=this.$refs.imgfileInput.files[0],s=new FileReader;s.readAsDataURL(n),s.onload=a=>{this.art.imageUrl=a.target.result}},upload(){if(this.art.imageUrl===this.oldimageUrl){this.done();return}const n=new FormData,s=this.$refs.imgfileInput.files[0];n.append("file-to-upload",s);const a=`${k}/api/${U}/admin/upload`;if(u.defaults.headers.common.Authorization=this.AdminToken,this.fileUrl===""){h.error("請選擇圖片");return}u.post(a,n).then(p=>{this.art.imageUrl=p.data.imageUrl,this.done()})}},async mounted(){await this.getAlldata(),this.AdminTokenCheck(),this.getArtdata(),this.artID=this.$route.params.id,this.$refs.imgfileInput.addEventListener("change",this.imagePreview)}},R={class:"container pt-5"},C={class:"row justify-content-center"},P={class:"col-12 col-md-9 col-lg-6"},S={class:"card mt-3"},L={class:"card-body"},j={class:"card-title"},B={key:0},N=t("i",{class:"bi bi-caret-left-fill h1 text-white-50"},null,-1),M={key:0},z=t("i",{class:"bi bi-caret-left-fill h1 text-white-50"},null,-1),H={class:"d-flex justify-content-center align-items-center btn btn-outline-secondary rounded-3"},O={type:"file",ref:"imgfileInput",id:"fileInput"},F=["src"],W={class:"text-center"},q=["src"],G={class:"mt-3 d-flex justify-content-center"},J={class:"mt-3"},K={class:""},Q={key:0},X={key:1},Y={class:"mt-3"},Z={class:""},$={key:0},tt={key:1},et={key:0,class:"mt-3"},st=t("label",{class:""},[t("span",null,"方案價格")],-1),it={class:"mt-3 d-flex justify-content-between"},ot=t("i",{class:"bi bi bi-x-circle-fill me-1"},null,-1),rt=t("span",null,"取消修改",-1),lt=[ot,rt],nt=t("i",{class:"bi bi-check-circle-fill me-1"},null,-1),at=t("span",null,"確定修改",-1),ct=[nt,at];function dt(n,s,a,p,e,c){const f=w("RouterLink");return i(),l("div",R,[t("div",C,[t("div",P,[t("div",S,[t("div",L,[t("h3",j,[e.artAuthor&&e.art.category==="作品"?(i(),g(f,{key:0,to:{name:"DashboardArt",params:{id:`${e.artAuthor}`}},class:"text text-white link-underline link-underline-opacity-0 d-flex"},{default:y(()=>[e.art.category==="作品"?(i(),l("span",B,[N,b(" 編輯作品 ")])):r("",!0)]),_:1},8,["to"])):r("",!0),e.artAuthor&&e.art.category==="作品"?(i(),g(f,{key:1,to:{name:"DashboardComission",params:{id:`${e.artAuthor}`}},class:"text text-white link-underline link-underline-opacity-0 d-flex"},{default:y(()=>[e.art.category==="報價"?(i(),l("span",M,[z,b(" 編輯方案 ")])):r("",!0)]),_:1},8,["to"])):r("",!0)]),t("div",{class:d(["justify-content-center",{"d-none":e.art.imageUrl!=="","d-flex":e.art.imageUrl===""}])},[t("div",{class:d({"col-12 col-md-6 col-lg-3":e.art.imageUrl=="","col-12 col-md-9 col-lg-6":e.art.imageUrl!=""})},[t("div",{class:d(["d-flex justify-content-center mw-50 ratio ratio-1x1",{uploadStyle:e.art.imageUrl==""}])},[t("label",H,[t("input",O,null,512),t("h3",{class:d(["m-0 p-0",{"d-block":e.art.imageUrl=="","d-none":e.art.imageUrl!=""}])}," + ",2),t("img",{src:e.art.imageUrl,ref:"imagePreview2",class:"mw-50 ratio-1x1"},null,8,F)])],2)],2)],2),t("div",W,[e.art.imageUrl?(i(),l("img",{key:0,class:"card-img-top w-50 ratio-1x1",src:e.art.imageUrl,alt:"作品圖片"},null,8,q)):r("",!0)]),t("div",G,[t("button",{type:"button",class:"w-100 btn btn-danger btn-lg",onClick:s[0]||(s[0]=o=>e.art.imageUrl="")}," 刪除圖片 ")]),t("div",J,[t("label",K,[e.art.category==="作品"?(i(),l("span",Q,"作品名稱：")):r("",!0),e.art.category==="報價"?(i(),l("span",X,"方案名稱：")):r("",!0)]),m(t("input",{type:"text",class:"form-control",placeholder:"作品名稱","onUpdate:modelValue":s[1]||(s[1]=o=>e.art.title=o)},null,512),[[_,e.art.title]])]),t("div",Y,[t("label",Z,[e.art.category==="作品"?(i(),l("span",$,"作品描述")):r("",!0),e.art.category==="報價"?(i(),l("span",tt,"方案描述")):r("",!0)]),m(t("input",{type:"text",class:"form-control",placeholder:"作品描述","onUpdate:modelValue":s[2]||(s[2]=o=>e.art.description=o)},null,512),[[_,e.art.description]])]),e.art.category==="報價"?(i(),l("div",et,[st,m(t("input",{type:"text",class:"form-control",placeholder:"方案價格","onUpdate:modelValue":s[3]||(s[3]=o=>e.art.price=o)},null,512),[[_,e.art.price]])])):r("",!0),t("div",it,[t("button",{type:"button",class:"btn btn-outline-primary btn-lg",onClick:s[4]||(s[4]=(...o)=>c.cancel&&c.cancel(...o))},lt),t("button",{type:"button",class:"btn btn-success btn-lg",onClick:s[5]||(s[5]=(...o)=>c.upload&&c.upload(...o))},ct)])])])])])])}const _t=x(V,[["render",dt]]);export{_t as default};
