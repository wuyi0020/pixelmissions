import{a as c}from"./axios-Bo0ATomq.js";import{_ as w,m as f,j as l,r as x,o as p,c as m,b as t,d as k,w as T,t as v,e as y,k as d,v as h}from"./index-Dp3lQOpW.js";import{U}from"./UserState-Ba9XQ2AO.js";var b={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:u,VITE_API_PATH:_,VITE_ADMIN_USERNAME:A,VITE_ADMIN_PASSWORD:I}=b,E=["Userlogin","AdminTokenCheck"],V={name:"UserRegister",data(){return{warningswitch:!1,warningText:"",username:"",password:"",email:""}},methods:{...f(U,E),registerCheck(){if(this.email===""||this.password===""){this.warningText="請輸入使用者名稱或密碼",this.warningswitch=!0;return}if(this.email.length<4||this.password.length<4){this.warningText="使用者名稱或密碼長度不足",this.warningswitch=!0;return}if(this.email.length>20||this.password.length>20){this.warningText="使用者名稱或密碼長度過長",this.warningswitch=!0;return}if(this.email.includes(" ")||this.password.includes(" ")||this.username.includes(" ")){this.warningText="使用者名稱或密碼不可包含空白",this.warningswitch=!0;return}this.warningText="",this.warningswitch=!1;const n=document.cookie.replace(/(?:(?:^|.*;\s*)RegToken\s*=\s*([^;]*).*$)|^.*$/,"$1");if(n){this.checkUserduplicates(n);return}const e={username:A,password:I},o=`${u}/admin/signin`;c.post(o,e).then(i=>{const{token:s,expired:a}=i.data;document.cookie=`RegToken=${s};expires=${new Date(a)}; path=/`,this.checkUserduplicates(s)}).catch(()=>{l.warning("註冊失敗 請稍後再試")})},checkUserduplicates(n,e=1){const o=`${u}/api/${_}/admin/products?category=使用者&page=${e}`;c.get(o,{headers:{Authorization:`${n}`}}).then(i=>{const s=Object.values(i.data.products).filter(a=>a.email===this.email);if(i.data.pagination.total_pages!==i.data.pagination.current_page&&s.length===0){this.checkUserduplicates(n,i.data.pagination.current_page+1);return}s.length===0?this.register(n):(this.warningText="使用者名稱已存在",this.warningswitch=!0)}).catch(()=>{})},register(n){const e=`${u}/api/${_}/admin/product`;let o={title:this.username,category:"使用者",origin_price:0,price:0,unit:"人",description:"我想我應該在這留下一句很有趣的話，可是我剛好想不到",content:"使用者資料",username:this.username,password:this.password,email:this.email,is_enabled:1,imageUrl:"https://fakeimg.pl/500x500/?retina=1&text=Not%20Set%20Head"};c.post(e,o={data:o},{headers:{Authorization:`${n}`}}).then(i=>{l.success("註冊成功"),this.$router.push({name:"Login"})}).catch(()=>{l.warning("註冊失敗 請稍後再試")})},backLogin(){this.$router.push("/login")}},mounted(){this.AdminTokenCheck(!0)}},D={class:"container-fluid h-100 justify-content-center align-items-center mt-5"},R={class:"row justify-content-center"},S={class:"col-sm-12 col-md-9 col-lg-6 col-xxl-4"},$={class:"card rounded-lg"},N={class:"card-body"},C=t("h2",{class:"display-4 text-center fw-bold text text-decoration-none"}," Pixel Missions ",-1),M=t("p",{class:"text-center text-secondary"},"接案的好幫手",-1),P=t("hr",null,null,-1),L=t("p",{class:"text-center text-secondary"},"註冊",-1),O={key:0,class:"text-center text-danger"},j={class:"form-floating mt-3"},B=t("label",{for:"floatingInput"},"電子郵件",-1),H={class:"form-floating mt-3"},z=t("label",{for:"floatingInput"},"暱稱",-1),W={class:"form-floating mt-3"},q=t("label",{for:"floatingInput"},"密碼",-1),F=t("hr",null,null,-1),G={class:"text-center mt-3 w-100"},J={class:"text-center mt-3 w-100"};function K(n,e,o,i,s,a){const g=x("router-link");return p(),m("div",D,[t("div",R,[t("div",S,[t("div",$,[t("div",N,[k(g,{to:{name:"Home"},class:"text text-decoration-none"},{default:T(()=>[C]),_:1}),M,P,L,s.warningswitch?(p(),m("p",O,v(s.warningText),1)):y("",!0),t("div",j,[d(t("input",{type:"text",class:"form-control",placeholder:"使用者名稱或電子郵件","onUpdate:modelValue":e[0]||(e[0]=r=>s.email=r)},null,512),[[h,s.email]]),B]),t("div",H,[d(t("input",{type:"text",class:"form-control",placeholder:"暱稱","onUpdate:modelValue":e[1]||(e[1]=r=>s.username=r)},null,512),[[h,s.username]]),z]),t("div",W,[d(t("input",{type:"password",class:"form-control",placeholder:"密碼","onUpdate:modelValue":e[2]||(e[2]=r=>s.password=r)},null,512),[[h,s.password]]),q]),F,t("div",G,[t("button",{class:"w-100 btn btn-primary rounded-pill",type:"button",onClick:e[3]||(e[3]=r=>a.registerCheck())}," 註冊 ")]),t("div",J,[t("button",{class:"w-100 btn btn-outline-primary rounded-pill",type:"button",onClick:e[4]||(e[4]=r=>a.backLogin())}," 回到登入 ")])])])])])])}const Z=w(V,[["render",K]]);export{Z as default};
