import{_ as f,a as w,m as b,z as h,o as m,c as U,b as s,x as o,e as A,A as a,B as c}from"./index-Bk2W6sNu.js";import{U as p}from"./UserState-D7ke27qt.js";import{a as d}from"./axios-Bo0ATomq.js";var v={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_API_PATH:_}=v,I=["Alldata","AdminToken","userHasLogIn","userID"],T=["AdminTokenCheck","getAlldata","setAdminToken"],x={data(){return{User:{},ThisUserID:"",oldimageUrl:""}},computed:{...w(p,I)},methods:{...b(p,T),async getArtdata(){await this.getAlldata(),this.User=this.Alldata[this.ThisUserID],this.oldimageUrl=this.Alldata[this.ThisUserID].imageUrl,this.userID!==this.ThisUserID&&this.$router.push(`/usercenter/${this.userID}`)},cancel(){this.$router.push(`/usercenter/${this.userID}`)},done(){this.setAdminToken();const l=`${g}/api/${_}/admin/product/${this.ThisUserID}`;d.defaults.headers.common.Authorization=this.AdminToken,d.put(l,{data:this.User}).then(e=>{this.$router.push(`/usercenter/${this.userID}`),h.success("修改成功")}).catch(()=>{h.warning("修改失敗")})},imagePreview(){const l=this.$refs.imgfileInput.files[0],e=new FileReader;e.readAsDataURL(l),e.onload=r=>{this.User.imageUrl=r.target.result}},upload(){if(this.User.imageUrl===this.oldimageUrl){this.done();return}const l=new FormData,e=this.$refs.imgfileInput.files[0];l.append("file-to-upload",e);const r=`${g}/api/${_}/admin/upload`;if(d.defaults.headers.common.Authorization=this.AdminToken,this.fileUrl===""){h.error("請選擇圖片");return}d.post(r,l).then(u=>{this.User.imageUrl=u.data.imageUrl,this.done()})},async UserDataCheck(){if(this.User.email===""||this.User.password===""){this.warningText="請輸入使用者名稱或密碼",this.warningswitch=!0;return}if(this.User.email.length<4||this.User.password.length<4){this.warningText="使用者名稱或密碼長度不足",this.warningswitch=!0;return}if(this.User.email.length>20||this.User.password.length>20){this.warningText="使用者名稱或密碼長度過長",this.warningswitch=!0;return}if(this.User.email.includes(" ")||this.User.password.includes(" ")||this.User.username.includes(" ")){this.warningText="使用者名稱或密碼不可包含空白",this.warningswitch=!0;return}await this.getAlldata(),Object.values(this.Alldata).filter(e=>e.email===this.User.email).length>1&&(this.warningText="使用者帳號已存在",this.warningswitch=!0)}},async mounted(){await this.getAlldata(),this.ThisUserID=this.$route.params.id,this.AdminTokenCheck(),this.getArtdata(),this.$refs.imgfileInput.addEventListener("change",this.imagePreview)}},y={class:"container pt-5"},D={class:"row justify-content-center"},k={class:"col-12 col-md-9 col-lg-6"},E={class:"card mt-3"},V={class:"card-body"},P=s("h1",{class:"card-title"},"編輯使用者資料",-1),R={class:"d-flex justify-content-center align-items-center btn btn-outline-secondary rounded-3"},S={type:"file",ref:"imgfileInput",id:"fileInput"},C=["src"],j={class:"text-center"},L=["src"],B={class:"mt-3 d-flex justify-content-center"},M={class:"mt-3"},N=s("label",{class:""},"名稱：",-1),z={class:"mt-3"},O=s("label",{class:""},"自我描述：",-1),H={class:"mt-3"},F=s("label",{class:""},"帳號/Email :",-1),W={class:"mt-3"},q=s("label",{class:""},"密碼：",-1),G={class:"mt-3 d-flex justify-content-between"},J=s("i",{class:"bi bi bi-x-circle-fill me-1"},null,-1),K=s("span",null,"取消修改",-1),Q=[J,K],X=s("i",{class:"bi bi-check-circle-fill me-1"},null,-1),Y=s("span",null,"確定修改",-1),Z=[X,Y];function $(l,e,r,u,t,n){return m(),U("div",y,[s("div",D,[s("div",k,[s("div",E,[s("div",V,[P,s("div",{class:o(["justify-content-center",{"d-none":t.User.imageUrl!=="","d-flex":t.User.imageUrl===""}])},[s("div",{class:o({"col-12 col-md-6 col-lg-3":t.User.imageUrl=="","col-12 col-md-9 col-lg-6":t.User.imageUrl!=""})},[s("div",{class:o(["d-flex justify-content-center mw-100 ratio ratio-1x1",{uploadStyle:t.User.imageUrl==""}])},[s("label",R,[s("input",S,null,512),s("h1",{class:o(["m-0 p-0",{"d-block":t.User.imageUrl=="","d-none":t.User.imageUrl!=""}])}," + ",2),s("img",{src:t.User.imageUrl,ref:"imagePreview2",class:"mw-100 ratio-1x1"},null,8,C)])],2)],2)],2),s("div",j,[t.User.imageUrl?(m(),U("img",{key:0,class:"card-img-top w-50 ratio-1x1",src:t.User.imageUrl},null,8,L)):A("",!0)]),s("div",B,[s("button",{type:"button",class:"w-100 btn btn-danger btn-lg",onClick:e[0]||(e[0]=i=>t.User.imageUrl="")}," 刪除圖片 ")]),s("div",M,[N,a(s("input",{type:"text",class:"form-control",placeholder:"使用者名稱","onUpdate:modelValue":e[1]||(e[1]=i=>t.User.title=i)},null,512),[[c,t.User.title]])]),s("div",z,[O,a(s("input",{type:"text",class:"form-control",placeholder:"描述","onUpdate:modelValue":e[2]||(e[2]=i=>t.User.description=i)},null,512),[[c,t.User.description]])]),s("div",H,[F,a(s("input",{type:"text",class:"form-control",placeholder:"Email","onUpdate:modelValue":e[3]||(e[3]=i=>t.User.email=i)},null,512),[[c,t.User.email]])]),s("div",W,[q,a(s("input",{type:"password",class:"form-control",placeholder:"Password","onUpdate:modelValue":e[4]||(e[4]=i=>t.User.password=i)},null,512),[[c,t.User.password]])]),s("div",G,[s("button",{type:"button",class:"btn btn-danger btn-lg",onClick:e[5]||(e[5]=(...i)=>n.cancel&&n.cancel(...i))},Q),s("button",{type:"button",class:"btn btn-success btn-lg",onClick:e[6]||(e[6]=(...i)=>n.upload&&n.upload(...i))},Z)])])])])])])}const is=f(x,[["render",$]]);export{is as default};
