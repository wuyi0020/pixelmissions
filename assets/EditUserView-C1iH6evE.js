import{_,a as w,m as b,j as u,o as m,c as U,b as s,n as a,e as A,k as c,v as d}from"./index-Cvp7A9jP.js";import{U as p}from"./UserState-CsnPMdK6.js";import{a as h}from"./axios-Bo0ATomq.js";var v={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"wuyi0020",VITE_ADMIN_USERNAME:"wuyi0020@gmail.com",VITE_ADMIN_PASSWORD:"wuyi0020",BASE_URL:"/pixelmissions/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_API_PATH:f}=v,I=["Alldata","AdminToken","userHasLogIn","userID"],T=["AdminTokenCheck","getAlldata","setAdminToken"],x={data(){return{User:{},ThisUserID:"",oldimageUrl:""}},computed:{...w(p,I)},methods:{...b(p,T),async getArtdata(){await this.getAlldata(),this.User=this.Alldata[this.ThisUserID],this.oldimageUrl=this.Alldata[this.ThisUserID].imageUrl,this.userID!==this.ThisUserID&&this.$router.push(`/usercenter/${this.userID}`)},cancel(){this.$router.push(`/dashboard/art/${this.userID}`)},done(){this.setAdminToken();const l=`${g}/api/${f}/admin/product/${this.ThisUserID}`;h.defaults.headers.common.Authorization=this.AdminToken,console.log(this.User),h.put(l,{data:this.User}).then(e=>{console.log(e),this.$router.push(`/usercenter/${this.userID}`),u.success("修改成功")}).catch(e=>{console.log(e),u.warning("修改失敗")})},imagePreview(){const l=this.$refs.imgfileInput.files[0],e=new FileReader;e.readAsDataURL(l),e.onload=o=>{this.User.imageUrl=o.target.result}},upload(){if(this.User.imageUrl===this.oldimageUrl){this.done();return}console.log("upload");const l=new FormData,e=this.$refs.imgfileInput.files[0];l.append("file-to-upload",e);const o=`${g}/api/${f}/admin/upload`;if(h.defaults.headers.common.Authorization=this.AdminToken,this.fileUrl===""){u.error("請選擇圖片");return}h.post(o,l).then(n=>{this.User.imageUrl=n.data.imageUrl,this.done()}).catch(n=>{console.log(n)})},async UserDataCheck(){if(this.User.email===""||this.User.password===""){this.warningText="請輸入使用者名稱或密碼",this.warningswitch=!0;return}if(this.User.email.length<4||this.User.password.length<4){this.warningText="使用者名稱或密碼長度不足",this.warningswitch=!0;return}if(this.User.email.length>20||this.User.password.length>20){this.warningText="使用者名稱或密碼長度過長",this.warningswitch=!0;return}if(this.User.email.includes(" ")||this.User.password.includes(" ")||this.User.username.includes(" ")){this.warningText="使用者名稱或密碼不可包含空白",this.warningswitch=!0;return}if(await this.getAlldata(),Object.values(this.Alldata).filter(e=>e.email===this.User.email).length>1){this.warningText="使用者帳號已存在",this.warningswitch=!0;return}console.log("UserDataCheck")}},async mounted(){await this.getAlldata(),this.ThisUserID=this.$route.params.id,this.AdminTokenCheck(),this.getArtdata(),this.$refs.imgfileInput.addEventListener("change",this.imagePreview)}},y={class:"container pt-5"},D={class:"row justify-content-center"},k={class:"col-12 col-md-9 col-lg-6"},E={class:"card mt-3"},V={class:"card-body"},P=s("h1",{class:"card-title"},"編輯使用者資料",-1),C={class:"d-flex justify-content-center align-items-center btn btn-outline-secondary rounded-3"},R={type:"file",ref:"imgfileInput",id:"fileInput"},S=["src"],j=["src"],L={class:"mt-3 d-flex justify-content-center"},M={class:"mt-3"},N=s("label",{class:"fs-1"},"名稱：",-1),B={class:"mt-3"},O=s("label",{class:"fs-1"},"自我描述",-1),z={class:"mt-3"},H=s("label",{class:"fs-1"},"帳號/Email",-1),F={class:"mt-3"},W=s("label",{class:"fs-1"},"密碼",-1),q={class:"mt-3 d-flex justify-content-between"},G=s("i",{class:"bi bi bi-x-circle-fill me-1"},null,-1),J=s("span",null,"取消修改",-1),K=[G,J],Q=s("i",{class:"bi bi-check-circle-fill me-1"},null,-1),X=s("span",null,"確定修改",-1),Y=[Q,X];function Z(l,e,o,n,t,r){return m(),U("div",y,[s("div",D,[s("div",k,[s("div",E,[s("div",V,[P,s("div",{class:a(["justify-content-center",{"d-none":t.User.imageUrl!=="","d-flex":t.User.imageUrl===""}])},[s("div",{class:a({"col-12 col-md-6 col-lg-3":t.User.imageUrl=="","col-12 col-md-9 col-lg-6":t.User.imageUrl!=""})},[s("div",{class:a(["d-flex justify-content-center mw-100 ratio ratio-1x1",{uploadStyle:t.User.imageUrl==""}])},[s("label",C,[s("input",R,null,512),s("h1",{class:a(["m-0 p-0",{"d-block":t.User.imageUrl=="","d-none":t.User.imageUrl!=""}])}," + ",2),s("img",{src:t.User.imageUrl,ref:"imagePreview2",class:"mw-100 ratio-1x1"},null,8,S)])],2)],2)],2),t.User.imageUrl?(m(),U("img",{key:0,class:"card-img-top ratio-1x1",src:t.User.imageUrl,alt:""},null,8,j)):A("",!0),s("div",L,[s("button",{type:"button",class:"w-100 btn btn-danger btn-lg",onClick:e[0]||(e[0]=i=>t.User.imageUrl="")}," 刪除圖片 ")]),s("div",M,[N,c(s("input",{type:"text",class:"form-control fs-3",placeholder:"使用者名稱","onUpdate:modelValue":e[1]||(e[1]=i=>t.User.title=i)},null,512),[[d,t.User.title]])]),s("div",B,[O,c(s("input",{type:"text",class:"form-control fs-3",placeholder:"描述","onUpdate:modelValue":e[2]||(e[2]=i=>t.User.description=i)},null,512),[[d,t.User.description]])]),s("div",z,[H,c(s("input",{type:"text",class:"form-control fs-3",placeholder:"Email","onUpdate:modelValue":e[3]||(e[3]=i=>t.User.email=i)},null,512),[[d,t.User.email]])]),s("div",F,[W,c(s("input",{type:"password",class:"form-control fs-3",placeholder:"Password","onUpdate:modelValue":e[4]||(e[4]=i=>t.User.password=i)},null,512),[[d,t.User.password]])]),s("div",q,[s("button",{type:"button",class:"btn btn-danger btn-lg",onClick:e[5]||(e[5]=(...i)=>r.cancel&&r.cancel(...i))},K),s("button",{type:"button",class:"btn btn-success btn-lg",onClick:e[6]||(e[6]=(...i)=>r.upload&&r.upload(...i))},Y)])])])])])])}const ts=_(x,[["render",Z]]);export{ts as default};
